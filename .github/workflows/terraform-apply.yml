name: "Terraform Apply"

on:
  workflow_call:  # Permite que este workflow seja chamado por outros workflows
    inputs:
      approve:
        description: "Aprova√ß√£o para aplicar mudan√ßas no Terraform (yes/no)"
        required: true
        type: string

jobs:
  terraform-apply:
    name: "Executar Terraform Apply"
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      - name: Verificar aprova√ß√£o para Apply
        if: ${{ inputs.approve }} == 'yes'
        working-directory: terraform
        run: |
          echo "üöÄ Terraform Plan gerado com sucesso!"
          echo "‚úÖ Aprova√ß√£o recebida. Continuando com Terraform Apply..."
          terragrunt apply -auto-approve

      - name: Cancelar Apply se n√£o aprovado
        if: ${{ inputs.approve }} == 'no'
        run: |
          echo "‚ùå Deploy cancelado pelo usu√°rio."
          exit 1